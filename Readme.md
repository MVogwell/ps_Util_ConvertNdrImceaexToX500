# ps_Util_ConvertNdrImceaexToX500.ps1

## SYNOPSIS
Creates a valid X500 address that can be added to Exchange from an address generated by an NDR (Non Delivery Report) starting 'IMCEAEX-'

## DESCRIPTION
When the legacyExchangeDN address is changed for a mailbox or contact in Exchange any existing NK2/cached addresses in Outlook will point to the old address. If anyone tries to send to that address they will get an NDR (because the address no longer exists). The answer to this is to either remove all of the old cached address entry in every Outlook that has used the address prior to it changing or to create an X500 type address and add it to the mailbox or mail contact email addresses list.  This script will convert the address in the NDR (starting IMCEAEX-) into a valid X500 address which can then be added as address to the mailbox or mail contact.


## PARAMETER NdrAddress
This is the address you find in an NDR starting IMCEAEX and contain the LegacyExchangeDC address. This will look something like (without the line breaks) IMCEAEX-_o=DomainName_ou=Exchange+20Administrative+20Group+20+28FYDIBOHF23SPDLT+29_cn=Recipients_cn=aa8d1e3228c94172b0081fb5c497beca-Bob+20Hope@contoso.com

## PARAMETER ReturnAddressOnly
This is a boolean parameter which specifies whether the header should be displayed and the outputted result copied to the clipboard (False) or just if the address only should be displayed on screen (true)

## EXAMPLE

.\ps_Util_ConvertNdrImceaexToX500.ps1 -NdrAddress "IMCEAEX-_o=DomainName_ou=Exchange+20Administrative+20Group+20+28FYDIBOHF23SPDLT+29_cn=Recipients_cn=aa8d1e3228c94172b0081fb5c497beca-Bob+20Hope@contoso.com"

This example would convert the address specified above to: "/o=DomainName/ou=Exchange Administrative Group (FYDIBOHF23SPDLT)/cn=Recipients/cn=aa8d1e3228c94172b0081fb5c497beca-Bob Hope" and would copy the string to the clipboard


## EXAMPLE

.\ps_Util_ConvertNdrImceaexToX500.ps1 -NdrAddress "IMCEAEX-_o=DomainName_ou=Exchange+20Administrative+20Group+20+28FYDIBOHF23SPDLT+29_cn=Recipients_cn=aa8d1e3228c94172b0081fb5c497beca-Bob+20Hope@contoso.com" -ReturnAddressOnly:$True

This example would convert the address to "/o=DomainName/ou=Exchange Administrative Group (FYDIBOHF23SPDLT)/cn=Recipients/cn=aa8d1e3228c94172b0081fb5c497beca-Bob Hope" but would just display the one line of the screen and wouldn't copy the result. This is useful if you want to pass a text file containing multiple addresses to the script using a foreach loop:

e.g.

ForEach($address in (Get-Content C:\Temp\ListOfImceaexAddresses.txt)) { . <path to the script>\ps_Util_ConvertNdrImceaexToX500.ps1 -NdrAddress $address -ReturnAddressOnly:$True }



## NOTES
MVogwell - v1.0 05-12-18

## LINK
Information about converting an address from an NDR to an X500 address can be found at https://support.microsoft.com/en-gb/help/2807779/imceaex-non-delivery-report-when-you-send-email-messages-to-an-interna
